---
title: "4.전체 데이터 시각화"
author: "jiseungRyu"
date: '2017 11 27 '
output: html_document
---

Load libraries and helper functions
```{r, message = FALSE}
# general visualisation
library(needs)
needs(tidyverse,scales,grid,gridExtra,RColorBrewer,corrplot,readr,stringr,
        data.table,tibble,tidyr,stringr,forcats,lubridate,ggforce,ggridges)
```


#### 정책이 달라지는 구간

| date              | energy      | location | Min/Max Price |
| ----------------- | ----------- | -------- | ------------- |
| 20120228~20150508 | General/Sun | Total    | No            |
| 20150513~20160217 | General/Sun | In/Out   | Yes           |
| 20160304~20170315 | Total       | In/Out   | Yes           |
| 20170328~20171128 | Total       | In/Out   | Yes           |

#### REC  가격

http://www.knrec.or.kr/knrec/index.asp

```{r}
rec <- read_csv("../data_need/REC_SMP.csv")

ggplot(data=rec, aes(x=ymd(date),y = price,color=type)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d")) +
  labs(y="price",x="date")
```


#### smp 가격

http://epsis.kpx.or.kr/epsisnew/selectEkmaSmpShdGrid.do?menuId=050202

```{r}
ggplot(data=rec, aes(x=ymd(date),y = SMP,color=type)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d")) +
  labs(y="price",x="date")
```

#### 2016년 이후만!

2016년 이후 육지와 제주는 가격 차이가 동일하고 같은 양상을 보인다.
육지/제주를 나눠서 예측할 것이다.

```{r}
rec %>% 
  subset(date>=20160304) %>% ggplot(aes(x=ymd(date),y = price,color=type)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d")) +
  labs(y="price",x="date")

```


```{r}
rec %>% 
  subset(date>=20160304) %>% ggplot(aes(x=ymd(date),y = SMP,color=type)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d")) +
  labs(y="price",x="date")

```
SMP 가격이 높아지면서 REC 가격 상승(최근)

#### 연료단가(20170501까지 밖에 자료가 없음)

http://epsis.kpx.or.kr

```{r}
fuel <- read_csv("../data_need/연료단가.csv")[-1,]
fuel$date <- gsub("월","",fuel$date)
fuel$year <- str_sub(fuel$date,1,4) %>% as.numeric()
fuel$month <- str_sub(fuel$date,6,8) %>% as.numeric()
fuel$date <- fuel %>% with(ifelse(nchar(month)==1,paste0(year,"0",month,"01"),paste0(year,month,"01")))
fuel <- fuel %>% select(-year, -month)
colnames(fuel)[3]<-"Bituminous_coal"

fuel$Oil_up <- c(1,diff(fuel$Oil))/fuel$Oil
fuel$LNG_up <- c(1,diff(fuel$LNG))/fuel$LNG
```

```{r}
fuel1 <- fuel %>% select(date, Oil, LNG)
fuel1 <- melt(fuel1, id.vars = "date")
fuel1$value <- fuel1$value %>% as.numeric()

theme.ti <- element_text(family="AppleMyungjo", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleMyungjo", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleMyungjo", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleMyungjo") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요


fuel1 %>%
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti) +
  labs(y="연료단가",x="date")
```

```{r}
fuel2 <- fuel %>% select(date, Oil_up, LNG_up)
fuel2 <- melt(fuel2, id.vars = "date")
fuel2$value <- fuel2$value %>% as.numeric()

theme.ti <- element_text(family="AppleMyungjo", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleMyungjo", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleMyungjo", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleMyungjo") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요


fuel2 %>%
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti) +
  labs(y="연료단가",x="date")
```

#### 물가지수(20171101까지 자료존재)

http://data.seoul.go.kr/openinf/linkview.jsp?infId=OA-11716

```{r}
Prices  <- read_csv("../data_need/물가.csv")
Prices$date <- Prices %>% with(ifelse(nchar(Prices$date)==6,paste0(date,"0.01"),paste0(date,".01")))

Prices$생활물가지수_up <- c(1,diff(Prices$생활물가지수))/Prices$생활물가지수
Prices$식품_up <- c(1,diff(Prices$식품))/Prices$식품
Prices$식품_이외_up <- c(1,diff(Prices$식품_이외))/Prices$식품_이외
Prices$전월세_up <- c(1,diff(Prices$전월세))/Prices$전월세
Prices$전월세포함_생활물가지수_up <- c(1,diff(Prices$전월세포함_생활물가지수))/Prices$전월세포함_생활물가지수
```


```{r}
Prices1 <- Prices %>% select(1:6)
Prices1 <- melt(Prices1, id.vars = "date")
Prices1$value <- Prices1$value %>% as.numeric()
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

Prices1 %>% 
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="연료단가",x="date")
```

```{r}
Prices2 <- Prices %>% select(1,7:11)
Prices2 <- melt(Prices2, id.vars = "date")
Prices2$value <- Prices2$value %>% as.numeric()
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

Prices2 %>% 
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="연료단가",x="date")
```


#### 전라남도 날씨 데이터(2016년부터 존재)

http://www.kweather.co.kr/main/main.html

```{r}
weather <- read_csv("../data_need/weather_전라남도.csv")
```

#### 맑음 더미 변수 사용하자.
```{r}
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

weather %>% select(-weather_str) %>% melt(id.vars = "date") %>%
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="온도/cm/mm",x="date")
```

#### 원유

http://www.opinet.co.kr/glopcoilSelect.do#

```{r}
Oil <- read_csv("../data_need/National_OIL.csv")

Oil$두바이유상승률 <- c(1,diff(Oil$두바이유))/Oil$두바이유
Oil$브렌트유상승률 <- c(1,diff(Oil$브렌트유))/Oil$브렌트유
Oil$서부텍사스중질유상승률 <- c(1,diff(Oil$서부텍사스중질유))/Oil$서부텍사스중질유
```

```{r}
Oil1 <- Oil %>% select(1:4)
Oil1 <- melt(Oil1, id.vars = "date")
Oil1$value <- Oil1$value %>% as.numeric()
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

Oil1 %>% 
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="price",x="date")
```

```{r}
Oil2 <- Oil %>% select(1,5:7)
Oil2 <- melt(Oil2, id.vars = "date")
Oil2$value <- Oil2$value %>% as.numeric()
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

Oil2 %>% 
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="price",x="date")
```

#### GDP

http://www.opinet.co.kr/glopcoilSelect.do#

```{r}
GDP <- read_csv("../data_need/GDP.csv")
colnames(GDP)[1] <- "date"
GDP$date <- substr(gsub("\r\r","/",GDP$date),1,6)
GDP$국내총생산_명목GDP_up <- c(1,diff(GDP$국내총생산_명목GDP))/GDP$국내총생산_명목GDP
GDP$경제성장률_실질GDP성장률_up <- c(1,diff(GDP$경제성장률_실질GDP성장률))/GDP$경제성장률_실질GDP성장률
GDP$date<- ifelse(substr(GDP$date,6,6)=="1",paste0(substr(GDP$date,1,4),"0301"),
                  ifelse(substr(GDP$date,6,6)=="2",paste0(substr(GDP$date,1,4),"0601"),
                         ifelse(substr(GDP$date,6,6)=="3",paste0(substr(GDP$date,1,4),"0901"),
                                ifelse(substr(GDP$date,6,6)=="4",paste0(substr(GDP$date,1,4),"1201"),"error"))))
```

```{r}
GDP1 <- GDP %>% select(1:3)

theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

p1 <- GDP1 %>% 
  ggplot(aes(x=ymd(date),y = 국내총생산_명목GDP)) + 
  geom_line(color="red") +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="국내총생산_명목GDP",x="date")

p2 <- GDP1 %>% 
  ggplot(aes(x=ymd(date),y = 경제성장률_실질GDP성장률)) + 
  geom_line(color="blue") +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="경제성장률_실질GDP성장률",x="date")

grid.arrange(p1,p2)
```

```{r}
GDP2 <- GDP %>% select(1,4:5)
GDP2 <- melt(GDP2, id.vars = "date")
GDP2$value <- GDP2$value %>% as.numeric()
theme.ti <- element_text(family="AppleGothic", face="bold", size=12) #그래프 제목 스타일 변경
theme.ax <- element_text(family="AppleGothic", face="bold", size=10, angle=00, hjust=0.54, vjust=0.5) #그래프 축 이름 스타일 변경
theme.leti<-element_text(family="AppleGothic", face="bold") #범례 제목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요
theme.lete<-element_text(family="AppleGothic") #범례 항목 (legend) 스타일 변경, 범례가 있을 경우에만 쓰세요

GDP2 %>% 
  ggplot(aes(x=ymd(date),y = value,color=variable)) + 
  geom_line() +
  scale_x_date(labels = date_format("%Y-%m-%d"))   + 
  theme(axis.title = theme.ax, plot.title = theme.ti, legend.title = theme.leti, legend.text = theme.lete) +
  labs(y="price",x="date")
```

#### 연말 변수 : 연말로 향할수록 RPS 불이행을 최소화하기 위해 가격이 오른 이력이 있다.

#### 정부정책 : 정부가 신재생에너지 생산량을 보호하기 위해 만든 시장이기 때문에 정부의 정책에 따라 크게 휘둘린다. Ex) 과징금, 통합 시장 이후 태양광 의무공급량 제한 해제, 정부의 신재생에너지 20%확대 정책 등
